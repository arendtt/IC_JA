# General info
declare Dataset="test" # Replace TOPMD with the name of your dataset
declare ResponsiblePI="Marcos_Santoro"
declare Email_PI="santorogen@gmail.com" 
declare Analyst="Julia_Arendt" 
declare Email_Analyst="julia.arendt@unifesp.br"
declare ANALYSISDIR="/mnt/genetica_1/Julia_Arendt/ENIGMA-CNV_Analysis"
declare deidentify="NA"

# a. Genetic information files - input specific to your genotyping chip
declare Chip="Illumina_DeCodeGenetics_V1_v2" # genotyping chip: Note - if your dataset is Affymetrix, make sure to put in "Affy6" - otherwise the script will not run appropriately
declare Chipversion="_" # version of chip (if applicable) [set as NA if non-applicable]
declare ILLUMINAREPORTDIR="${ANALYSISDIR}"  # absolute path to your Illumina-Final Report-file. Can be replaced with ${ANALYSISDIR} if you placed it there
declare IlluminaReport="339syni_DeCodeGenetics_V1_v2_FinalReport.txt" # name of your Illumina-Final Report-file
declare SNPPosFile="339syni_DeCodeGenetics_V1_v2_SNP_Map.txt" 
	# The snp-position-file is a tab-delimited file with the positions of the SNPs on your chip, containing at least the columns below (with the exact (!) headers). These columns are for instance present in the SNP-map-file [.map] generated together with your IlluminaReport or the Illumina manifest file [.bpm]:
	# Name	Chromosome	Position
	# rs1000000	12	126890980
	# rs1000002	3	183635768
	# rs10000023	4	95733906
declare genomeversion="hg19" 
# IF BAF-LRR-files already present for your dataset (for instance Affy-users)
declare BAFLRRpresent="yes" # USER-INPUT - only put "yes" if you have BAF-LRR-files ready available - otherwise, leave the "no"
if [ $BAFLRRpresent = "yes" ]
    then
    declare LRRBAFDIR="/${ANALYSISDIR}/LRRBAF_Files/" # USER-INPUT -  directory with PennCNV-inputfiles
# NOTE - if the lrr-baf-folder has several subfolders with lrrbaf-files, the script may run into issues... If so, please contact the helpdesk
    else
    mkdir ${ANALYSISDIR}/LRRBAF_Files/
declare LRRBAFDIR="${ANALYSISDIR}/LRRBAF_Files/" # Note - this will place the PennCNV input files in a subfolder of  your ENIGMA-CNV analysis folder. These take up quite a lot of space - if you wish them to be placed elsewhere, write the full path of the wanted folder (USER-INPUT)
fi
# Post/prefixes in LRR-BAF-files
declare postscript="" # e.g ".penn" # IF converting from IlluminaFinalReport to LRRBAF-files with this script, this should be left empty. LRR-BAF files from previous convertions may have a postfix (e.g. ".penn", "_lrrbaf"), please input this here (USER-INPUT).
declare Affyprescript="" # e.g. "gw." # Affymetrix files names often get this prescript, which needs to be removed to couple samples. Replace with different prescript if relevant (USER-INPUT).

# b. Cohort-generated files
declare SexFile="${ANALYSISDIR}/SexFile.txt" # USER-INPUT - absolute path to your sex-file
# If sex for a sample is not provided in sexfile, or if --sexfile is not specified, PennCNV will try to predict the gender of the sample. It is highly recommended to provide a sexfile [saves time].
declare gendermissing="0" # USER-INPUT, number of individuals with gender missing in sexfile
declare RelativeFile="${ANALYSISDIR}/DupsRelatives.txt" # USER-INPUT - absolute path to your relative-file
declare KeepFile="" # USER-INPUT # absolute path to your KeepFile.txt - leave empty if you do not have a KeepFile
declare RemoveFile="${ANALYSISDIR}/RemoveFile.txt" # USER-INPUT # absolute path to your RemoveFile.txt - leave empty if you do not have a RemoveFile

### c. Genotyping-chip dependent information - 
declare HMMname="/opt/PennCNV-1.0.5/lib/hhall.hmm" # USER-INPUT - Please replace with the correct HMM-file. examples:  /opt/PennCNV-1.0.5/lib/hhall.hmm; for /opt/PennCNV-1.0.5/libhh550.hmm /opt/PennCNV-1.0.5/affy/libgw6/affygw6.hmm

# IF your dataset has more than 300 individuals, you can generate your own PFB-file based on the frequency in your dataset
declare NoofIndividuals="" # e.g "1000" # No of individuals (e.g. "300") to be used for generating PFB-file and GCC-file (must be at least 300 individuals of good quality). Leave empty if you want to use all your individuals. The more individuals you use, the more precise the estimate becomes but the longer it will take to generate the PFB-model. For the NORMENT dataset, generating a PFB- and GCMODEL-file for the OmniExpress12v1.0 containing 730,525 markers using 1000 individuals took ~90 min on a Mac laptop with a 2.53 GHz Intel Core i5 processor and 4 GB of working memory

# IF your dataset contains less than 300 individuals, you need to use a generic version of the PFB-file. Please confer with the ENIGMA-CNV working group and put in the correct names of the files. # NOTE - IF more than 300 individuals, these files will be generated later and named "${Dataset}_${genomeversion}.pfb" (likewise for GCName)
declare PFB="hhall.${genomeversion}" # ONLY USER-INPUT for those with <300 individuals -  replace with the correct PFB & GCMODEL (note without extensions) 
declare PFBname="${PFB}.pfb"  # no input 
declare GCname="${PFB}.gcmodel" # no input

#####################################################################
## 0b. State cut-offs and predefined files/folders - NO user input ##
#####################################################################

# a. List of input and output-files from ENIGMA CNV calling protocol
declare List_preQC="${Dataset}_ListofInputFiles_preQC.txt"
declare List_postQC="${Dataset}_ListofInputFiles_postQC.txt"

# b. Cut-offs, autosomal chromosomes filtering
declare LRR_SD=0.40 
declare BAF_drift=0.02 
declare WF=0.05
declare NoofSNPs=15
declare MergeFraction=0.30 # depending on chip, this may need adjustment - this was appropriate for Illumina OmniExpress where 0.2 was too low. 
declare MinQueryFrac=0.5 # define the overlap with the regions necessary to be excluded

# c. Cut-offs, X chromosome filtering
# For the X-chromoxome, only small CNVs are removed and CNVs merged whereas BAF-drift and WF, LRR_SD are skipped (by setting them abnormally high) to not filter based on X-chromosome only.
declare NoofSNPs_X=15
declare MergeFraction_X=0.30
declare LRR_SD_X=0.99 
declare BAF_drift_X=0.99 
declare WF_X=0.99 

### d. Parameters needed for visualization
declare VISUALIZEDIR=${ANALYSISDIR}/${Dataset}_visualize/
mkdir ${VISUALIZEDIR}
declare CNVofInterestFile="CNVsofInterest_ENIGMA-CNV_${genomeversion}.csv" # appropriate CNVsofInterest-file for visualization (changes according to genome version)
Overlapref=0.3 # How large a proportion of the CNV is overlapping with the CNVofInterest? 
OverlapMin=0.35 # Minimum overlap
OverlapMax=5 # Maximum overlap

### e. Output directories (to not clutter Analysis-dir)
declare OUTDIR=${ANALYSISDIR}/${Dataset}_output/
mkdir ${OUTDIR}
